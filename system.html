<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Complaint or Issue Reporting System — Pasig Catholic College</title>
  <style>
    :root {
      --primary: #8b0000;
      --muted: #666;
      --card-bg: #fff;
      --page-bg: #f4f4f4;
    }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--page-bg);
      color: #222;
    }
    header {
      background: var(--primary);
      color: #fff;
      padding: 12px 18px;
      text-align: center;
    }
    .wrap {
      max-width: 980px;
      margin: 18px auto;
      padding: 0 12px;
    }
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      margin-bottom: 16px;
    }

    label { display: block; margin-top: 10px; font-weight: 600; }
    input, textarea, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    textarea { resize: vertical; min-height: 80px; }
    button { background: var(--primary); color: #fff; border: none; cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.3s ease; }
    button:hover { background: #a30000; }
    button.gray { background: #666; }
    button.gray:hover { background: #555; }
    .two { display: flex; gap: 10px; }
    .two > * { flex: 1; }

    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top; }
    th { background: var(--primary); color: #fff; }
    .actionBtns button { margin-right: 8px; margin-bottom: 6px; }
    .hidden { display: none; }

    @media (max-width:640px) { .two { flex-direction: column; } }

    .priority-buttons { display:flex; gap:10px; margin-top:8px; }
    .priority-buttons button { flex:1; }
    #priorityMessage { margin-top:10px; color:#b30000; font-weight:bold; display:none; }

  </style>
</head>
<body>
  <header>
    <h2>Pasig Catholic College — Complaint & Issue Reporting System</h2>
  </header>

  <div class="wrap">
    <div id="loginCard" class="card">
      <h1>Login</h1>
      <div id="roleInfo" style="color:var(--muted); margin-bottom:8px;"></div>
      <label>Username</label>
      <input id="loginUser" placeholder="Your username">
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="Your password">
      <div style="margin-top:12px;">
        <button onclick="doLogin()">Continue to Dashboard</button>
        <button class="gray" onclick="goBack()">Back</button>
      </div>
    </div>

    
    <div id="studentCard" class="card hidden">
      <h3>Student Complaint Form</h3>

      <div class="two">
        <div>
          <label>Reference Number</label>
          <input id="refNumber" readonly>
        </div>
        <div>
          <label>Date</label>
          <input id="dateField" readonly>
        </div>
      </div>

      <label>Name</label>
      <input id="name" placeholder="Full name">

      <label>Student Number</label>
      <input id="studentNumber" placeholder="ID or Employee number">

      <label>Subject</label>
      <input id="subject" placeholder="Subject / Category">

      <label>Priority</label>
      <div class="priority-buttons">
        <button type="button" onclick="setPriority(true)">Yes</button>
        <button type="button" onclick="setPriority(false)">No</button>
      </div>
      <div id="priorityMessage">⚠ You have marked this complaint as High Priority. This means your concern is considered serious and requires immediate attention from the administration. Please make sure all details are accurate and clearly stated before submitting.</div>

      <label>Complaint / Issue</label>
      <textarea id="issue" placeholder="Describe the issue..."></textarea>

      <div style="margin-top:12px;">
        <button onclick="saveComplaint()">Submit Complaint</button>
        <button class="gray" onclick="logout()">Logout</button>
      </div>
    </div>

    
    <div id="studentListCard" class="card hidden">
      <h3>Your Complaints</h3>
      <label>Search by Reference #</label>
      <input id="searchStudent" placeholder="Type reference number..." oninput="searchStudentTable()">
      <table id="studentTable">
        <thead>
          <tr>
            <th>Reference #</th><th>Name</th><th>Student #</th><th>Subject</th><th>Priority</th><th>Issue</th><th>Status</th><th>Remarks</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    
    <div id="adminCard" class="card hidden">
      <h3>Admin Dashboard</h3>

      <div class="two">
        <div>
          <label>Filter by Subject (category)</label>
          <input id="filterCategory" placeholder="Type to filter by subject" oninput="filterAdminTable()">
        </div>
        <div>
          <label>Filter by Priority / Keyword</label>
          <input id="filterUrgency" placeholder="Type to filter by priority (High/Normal) or keyword" oninput="filterAdminTable()">
        </div>
      </div>

      <table id="adminTable">
        <thead>
          <tr>
            <th>Reference #</th><th>Name</th><th>Student #</th><th>Subject</th><th>Priority</th><th>Issue</th><th>Status</th><th>Remarks</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:12px;">
        <button class="gray" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

<script>
const STORAGE_KEY = 'pcc_complaints_v1';
let reports = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
let editIndex = -1;
let chosenPriority = 'No';


const chosenRole = localStorage.getItem('pccRole');
if (!chosenRole) location.href = 'index.html';
document.getElementById('roleInfo').textContent = 'Welcome! You’ve selected the ' + (chosenRole === 'student' ? 'Student Account' : 'Admin Account') + '.';


const loginCard = document.getElementById('loginCard');
const studentCard = document.getElementById('studentCard');
const studentListCard = document.getElementById('studentListCard');
const adminCard = document.getElementById('adminCard');
const priorityMsg = document.getElementById('priorityMessage');


function generateRefNumber() { return 'REF-' + Math.floor(100000 + Math.random() * 900000); }
function setNewFormRefAndDate() {
  document.getElementById('refNumber').value = generateRefNumber();
  document.getElementById('dateField').value = new Date().toLocaleString();
}
setNewFormRefAndDate();


function setPriority(isYes) {
  chosenPriority = isYes ? 'High' : 'Normal';
  priorityMsg.style.display = isYes ? 'block' : 'none';
}


function doLogin() {
  const user = document.getElementById('loginUser').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  if (!user || !pass) { alert('Please enter username and password.'); return; }

  loginCard.classList.add('hidden');
  if (chosenRole === 'student') {
    studentCard.classList.remove('hidden');
    studentListCard.classList.remove('hidden');
    displayStudentTable();
  } else {
    adminCard.classList.remove('hidden');
    displayAdminTable();
  }
}


function saveComplaint() {
  const ref = document.getElementById('refNumber').value;
  const name = document.getElementById('name').value.trim();
  const studentNumber = document.getElementById('studentNumber').value.trim();
  const subject = document.getElementById('subject').value.trim();
  const issue = document.getElementById('issue').value.trim();
  const date = document.getElementById('dateField').value;
  const urgency = chosenPriority;

  if (!name || !studentNumber || !subject || !issue) { alert('Please fill out all fields.'); return; }

  if (editIndex === -1) {
    reports.push({ ref, name, studentNumber, subject, urgency, issue, status: 'Pending', remarks: '', date });
    saveToStorage();
    alert('Complaint submitted! Reference: ' + ref);
    clearForm();
    setNewFormRefAndDate();
    displayStudentTable();
    displayAdminTable();
  } else {
    reports[editIndex].name = name;
    reports[editIndex].studentNumber = studentNumber;
    reports[editIndex].subject = subject;
    reports[editIndex].urgency = urgency;
    reports[editIndex].issue = issue;
    saveToStorage();
    alert('Complaint updated successfully!');
    editIndex = -1;
    clearForm();
    setNewFormRefAndDate();
    displayStudentTable();
    displayAdminTable();
  }
}


function displayStudentTable() {
  const tbody = document.querySelector('#studentTable tbody');
  tbody.innerHTML = '';
  reports.forEach((r, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.ref}</td>
      <td>${escapeHtml(r.name)}</td>
      <td>${escapeHtml(r.studentNumber)}</td>
      <td>${escapeHtml(r.subject)}</td>
      <td>${escapeHtml(r.urgency)}</td>
      <td>${escapeHtml(r.issue)}</td>
      <td>${escapeHtml(r.status)}</td>
      <td>${escapeHtml(r.remarks)}</td>
      <td class="actionBtns">
        <button onclick="loadForEdit(${idx})">Edit</button>
        <button onclick="deleteComplaint(${idx})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function displayAdminTable(filteredList) {
  const list = filteredList || reports;
  const tbody = document.querySelector('#adminTable tbody');
  tbody.innerHTML = '';
  list.forEach((r, idx) => {
    const realIndex = filteredList ? reports.indexOf(r) : idx;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.ref}</td>
      <td>${escapeHtml(r.name)}</td>
      <td>${escapeHtml(r.studentNumber)}</td>
      <td>${escapeHtml(r.subject)}</td>
      <td>${escapeHtml(r.urgency)}</td>
      <td>${escapeHtml(r.issue)}</td>
      <td>
        <select onchange="changeStatus(${realIndex}, this.value)">
          <option ${r.status === 'Pending' ? 'selected' : ''}>Pending</option>
          <option ${r.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
          <option ${r.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
        </select>
      </td>
      <td><textarea id="remark-${realIndex}" rows="2">${escapeHtml(r.remarks)}</textarea></td>
      <td><button onclick="applyRemark(${realIndex})">Save Remark</button> <button onclick="deleteComplaint(${realIndex})">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });
}


function applyRemark(index) {
  reports[index].remarks = document.getElementById('remark-' + index).value;
  saveToStorage();
  displayStudentTable();
}
function changeStatus(index, value) {
  reports[index].status = value;
  saveToStorage();
  displayStudentTable();
}

function filterAdminTable() {
  const cat = document.getElementById('filterCategory').value.trim().toLowerCase();
  const urg = document.getElementById('filterUrgency').value.trim().toLowerCase();

  if (!cat && !urg) {
    displayAdminTable();
    return;
  }

  const filtered = reports.filter(r => {
    const subject = (r.subject || '').toString().toLowerCase();
    const urgency = (r.urgency || '').toString().toLowerCase();
    const issue = (r.issue || '').toString().toLowerCase();
    const name = (r.name || '').toString().toLowerCase();

    const matchCat = cat ? subject.includes(cat) : true;
    const matchUrg = urg ? (urgency.includes(urg) || issue.includes(urg) || name.includes(urg)) : true;

    return matchCat && matchUrg;
  });

  displayAdminTable(filtered);
}

function clearForm() {
  document.getElementById('name').value = '';
  document.getElementById('studentNumber').value = '';
  document.getElementById('subject').value = '';
  document.getElementById('issue').value = '';
  chosenPriority = 'No';
  priorityMsg.style.display = 'none';
}
function deleteComplaint(index) {
  if (!confirm('Delete this complaint?')) return;
  reports.splice(index, 1);
  saveToStorage();
  displayStudentTable();
  displayAdminTable();
}
function loadForEdit(index) {
  const r = reports[index];
  document.getElementById('refNumber').value = r.ref;
  document.getElementById('dateField').value = r.date;
  document.getElementById('name').value = r.name;
  document.getElementById('studentNumber').value = r.studentNumber;
  document.getElementById('subject').value = r.subject;
  document.getElementById('issue').value = r.issue;
  chosenPriority = r.urgency;
  priorityMsg.style.display = chosenPriority === 'High' ? 'block' : 'none';
  editIndex = index;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function saveToStorage() { localStorage.setItem(STORAGE_KEY, JSON.stringify(reports)); }
function logout() { localStorage.removeItem('pccRole'); location.href = 'index.html'; }
function goBack() { location.href = 'index.html'; }
function escapeHtml(str) {
  return str ? String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[s])) : '';
}

(function initOnLoad() {
  displayStudentTable();
  displayAdminTable();
})();
</script>
</body>
</html>
